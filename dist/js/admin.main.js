(()=>{"use strict";const e=e=>{const t=document.getElementById("table-body");t&&(t.innerHTML="",e.forEach((e=>{t.insertAdjacentHTML("beforeend",`\n        <tr data-key="${e.id}">\n          <th scope="row">${e.id}</th>\n          <td>${e.login}</td>\n          <td>${e.password}</td>\n          <td>${e.children?"Да":"Нет"}</td>\n          <td>\n            <div class="form-check form-switch">\n              <input class="form-check-input" type="checkbox" role="switch"\n                  id="form-children" ${e.permission?"checked":""}>\n            </div>\n          </td>\n          <td>\n            <div class="btn-group btn-group-sm" role="group" aria-label="Basic example">\n              <button type="button" class="btn btn-warning btn-edit">\n                <i class="bi-pencil-square"></i>\n              </button>\n              <button type="button" class="btn btn-danger btn-remove">\n                <i class="bi-person-x"></i>\n              </button>\n            </div>\n          </td>\n        </tr>\n        `)})))},t=e=>{const t=document.getElementById("tbody");t&&(t.innerHTML="",e.forEach((e=>{t.insertAdjacentHTML("beforeend",`\n        <tr class="table__row" data-key="${e.id}">\n\t\t\t\t\t\t<td class="table__id table__cell">${e.id}</td>\n\t\t\t\t\t\t<td class="table-type table__cell">${e.type}</td>\n\t\t\t\t\t\t<td class="table-name table__cell">\n            ${e.name}\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td class="table-units table__cell">\n            ${"м2"==e.units?"м<sup>2</sup>":e.units}\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td class="table-cost table__cell">\n            ${e.cost} руб\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<div class="table__actions table__cell">\n\t\t\t\t\t\t\t\t<button class="button action-change btn-edit"><span class="svg_ui"><svg class="action-icon_change"><use xlink:href="./img/sprite.svg#change"></use></svg></span><span>Изменить</span>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t<button class="button action-remove btn-remove"><span class="svg_ui"><svg class="action-icon_remove"><use xlink:href="./img/sprite.svg#remove"></use></svg></span><span>Удалить</span>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n        `)})))};window.userService=new class{getUsers(){return fetch("http://localhost:3535/users").then((e=>e.json()))}addUsers(e){return fetch("http://localhost:3535/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.json()))}removeUser(e){return fetch(`http://localhost:3535/users/${e}`,{method:"DELETE"}).then((e=>e.json()))}changeUser(e,t){return fetch(`http://localhost:3535/users/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>e.json()))}getUser(e){return fetch(`http://localhost:3535/users/${e}`).then((e=>e.json()))}editUser(e,t){return fetch(`http://localhost:3535/users/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>e.json()))}filterUsers(e){return fetch(`http://localhost:3535/users?${e}=true`).then((e=>e.json()))}getSortUsers(e,t){return fetch(`http://localhost:3535/users?_sort=${e.name}&_order=${e.value}`).then((e=>e.json()))}},userService.getUsers().then((t=>{e(t)})),window.repairService=new class{getRepairs(){return fetch("http://localhost:4545/repairTypes").then((e=>e.json()))}addRepairs(e){return fetch("http://localhost:4545/repairTypes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.json()))}removeRepair(e){return fetch(`http://localhost:4545/repairTypes/${e}`,{method:"DELETE"}).then((e=>e.json()))}getRepair(e){return fetch(`http://localhost:4545/repairTypes/${e}`).then((e=>e.json()))}editRepair(e,t){return fetch(`http://localhost:4545/repairTypes/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>e.json()))}filterRepairs(e){return fetch(`http://localhost:4545/repairTypes?type=${e}`).then((e=>e.json()))}getSortRepairs(e,t){return fetch(`http://localhost:4545/repairTypes?_sort=${e.name}&_order=${e.value}`).then((e=>e.json()))}},repairService.getRepairs().then((e=>{t(e)})),(()=>{const t=document.querySelector("form"),s=t.querySelector("#name"),n=t.querySelector("#type");t&&t.addEventListener("submit",(r=>{if(r.preventDefault(),!t.dataset.user){const r={login:s.value,password:n.value};userService.addUsers(r).then((()=>{userService.getUsers().then((s=>{e(s),t.reset()}))}))}}))})(),(()=>{const t=document.getElementById("table-body");t&&t.addEventListener("click",(t=>{if(t.target.closest(".btn-remove")){const s=t.target.closest("tr").dataset.key;userService.removeUser(s).then((()=>{userService.getUsers().then((t=>{e(t)}))}))}}))})(),(()=>{const t=document.getElementById("table-body");t&&t.addEventListener("click",(t=>{if(t.target.closest("input[type='checkbox']")){const s=t.target.closest("tr"),n=s.querySelector("input[type='checkbox']"),r=s.dataset.key;userService.changeUser(r,{permission:n.checked}).then((()=>{userService.getUsers().then((t=>{e(t)}))}))}}))})(),(()=>{const t=document.getElementById("table-body"),s=document.querySelector("form"),n=s.querySelector("#name"),r=s.querySelector("#type");t&&s&&(t.addEventListener("click",(e=>{if(e.target.closest(".btn-edit")){const t=e.target.closest("tr").dataset.key;userService.getUser(t).then((e=>{n.value=e.login,r.value=e.password,s.dataset.user=t}))}})),s.addEventListener("submit",(t=>{if(t.preventDefault(),s.dataset.user){const t={login:n.value,password:r.value};userService.editUser(s.dataset.user,t).then((()=>{userService.getUsers().then((t=>{e(t),s.reset(),s.removeAttribute("data-user")}))}))}})))})(),(()=>{const t=document.getElementById("btn-isChildren"),s=document.getElementById("btn-isPermissions"),n=document.getElementById("btn-isAll");t&&s&&n&&(t.addEventListener("click",(()=>{userService.filterUsers("children").then((t=>{e(t)}))})),s.addEventListener("click",(()=>{userService.filterUsers("permission").then((t=>{e(t)}))})),n.addEventListener("click",(()=>{userService.getUsers().then((t=>{e(t)}))})))})(),(()=>{const t=document.getElementById("sort-is-children");if(t){let s=!1;t.style.cursor="pointer",t.addEventListener("click",(()=>{userService.getSortUsers({name:"children",value:s?"asc":"desc"}).then((t=>{e(t)})),s=!s}))}})(),(()=>{const e=document.querySelector(".button.btn-addItem");e&&(e.addEventListener("click",(()=>{const e=document.getElementById("modal");e&&(e.style.display="flex",e.addEventListener("click",(t=>{t.target.closest(".modal")&&!t.target.closest(".button__close")||(e.style.display="")})))})),(()=>{const e=document.querySelector("form"),s=e.querySelector("#type"),n=e.querySelector("#name"),r=e.querySelector("#units"),a=e.querySelector("#cost");e&&e.addEventListener("submit",(o=>{if(o.preventDefault(),!e.dataset.repair){const o={type:s.value,name:n.value,units:r.value,cost:a.value};repairService.addRepairs(o).then((()=>{repairService.getRepairs().then((s=>{t(s),e.reset()}))}))}}))})(),document.getElementById("modal")&&(document.getElementById("modal").style.display=""))})(),(()=>{const e=document.getElementById("tbody");e&&e.addEventListener("click",(e=>{if(e.target.closest(".btn-remove")){const s=e.target.closest("tr").dataset.key;repairService.removeRepair(s).then((()=>{repairService.getRepairs().then((e=>{t(e)}))}))}}))})(),(()=>{const e=document.getElementById("tbody"),s=document.querySelector("form"),n=s.querySelector("#type"),r=s.querySelector("#name"),a=s.querySelector("#units"),o=s.querySelector("#cost");e&&s&&(e.addEventListener("click",(e=>{if(e.target.closest(".btn-edit")){const t=e.target.closest("tr").dataset.key,c=document.getElementById("modal");c&&(c.querySelector(".modal__header").textContent="Редактирование услуги",c.style.display="flex",c.addEventListener("click",(e=>{e.target.closest(".modal")&&!e.target.closest(".button__close")||(c.style.display="")}))),(e=>{repairService.getRepair(e).then((t=>{n.value=t.type,r.value=t.name,a.value=t.units,o.value=t.cost,s.dataset.repair=e}))})(t)}})),s.addEventListener("submit",(e=>{if(e.preventDefault(),s.dataset.repair){const e={type:n.value,name:r.value,units:a.value,cost:o.value};repairService.editRepair(s.dataset.repair,e).then((()=>{repairService.getRepairs().then((e=>{t(e),s.reset(),s.removeAttribute("data-repair"),document.getElementById("modal").style.display=""}))}))}})))})(),(()=>{const e=document.getElementById("typeItem");repairService.getRepairs().then((e=>{const t=document.getElementById("typeItem");let s=[];e.forEach((e=>{let t=!1;s.length?(s.forEach((s=>{e.type==s&&(t=!0)})),t||s.push(e.type),t=!1):s.push(e.type)})),t&&(t.innerHTML='<option value="Все услуги">Все услуги</option>',s.forEach(((e,s)=>{let n=document.createElement("option");n.value=e,n.textContent=e,t.append(n)})))})),e&&e.addEventListener("change",(()=>{"Все услуги"==e.value?repairService.getRepairs().then((e=>{t(e)})):repairService.filterRepairs(e.value).then((e=>{t(e)}))}))})(),(()=>{const e=document.querySelector("table"),s=e.querySelector(".th-id"),n=e.querySelector(".th-type"),r=e.querySelector(".th-name"),a=e.querySelector(".th-units"),o=e.querySelector(".th-cost");let c=!1;e&&s&&n&&r&&a&&o&&(s.addEventListener("click",(()=>{repairService.getSortRepairs({name:"id",value:c?"asc":"desc"}).then((e=>{t(e)})),0==c?s.classList.add("down"):s.classList.remove("down"),c=!c})),n.addEventListener("click",(()=>{repairService.getSortRepairs({name:"type",value:c?"asc":"desc"}).then((e=>{t(e)})),0==c?n.classList.add("down"):n.classList.remove("down"),c=!c})),r.addEventListener("click",(()=>{repairService.getSortRepairs({name:"name",value:c?"asc":"desc"}).then((e=>{t(e)})),0==c?r.classList.add("down"):r.classList.remove("down"),c=!c})),a.addEventListener("click",(()=>{repairService.getSortRepairs({name:"units",value:c?"asc":"desc"}).then((e=>{t(e)})),0==c?a.classList.add("down"):a.classList.remove("down"),c=!c})),o.addEventListener("click",(()=>{repairService.getSortRepairs({name:"cost",value:c?"asc":"desc"}).then((e=>{t(e)})),0==c?o.classList.add("down"):o.classList.remove("down"),c=!c})))})()})();